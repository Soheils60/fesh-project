<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCmT1fhhlwlJ_EqqLdgNDNNEdb53MzCCR4",
    authDomain: "fesh-project.firebaseapp.com",
    databaseURL: "https://fesh-project-default-rtdb.firebaseio.com",
    projectId: "fesh-project",
    storageBucket: "fesh-project.appspot.com",
    messagingSenderId: "775712995019",
    appId: "1:775712995019:web:d6658af65a13bbe737cd4e"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const dataRef = ref(db, 'submissions');

  // ðŸŸ¢ ØªØ±ØªÛŒØ¨ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø¯Ù„Ø®ÙˆØ§Ù‡
  const fieldOrder = [
    "farmId", "date", "farmerName", "mobileNumber", "location", "cropType", "fieldArea", "estimatedYield",
    "slopeClass", "slopeDirection", "landscapePosition", "surfaceForm",
    "infiltrationMinute", "infiltrationSecond", "soilStructure", "tillageLayer", "soilStrength",
    "soilPh", "soilColor",
    "emergenceRate", "rootDevelopment", "rootCoating",
    "earthwormActivity", "myceliumDevelopment", "earthwormCount"
  ];

  window.onload = () => {
    const headerRow = document.getElementById('tableHeader');
    const tbody = document.getElementById('tableBody');
    const modal = document.getElementById('modal');
    const modalContentTable = document.getElementById('detailsTable');
    const closeModal = document.getElementById('closeModal');

    onValue(dataRef, (snapshot) => {
      const data = snapshot.val();
      if (!data) {
        document.body.innerHTML += '<p>No data available in Firebase.</p>';
        return;
      }

      const entries = Object.values(data);

      // ðŸ” Ø³Ø§Ø®Øª Ù‡Ø¯Ø± Ø¨Ø§ ØªØ±ØªÛŒØ¨ Ù…Ø´Ø®Øµâ€ŒØ´Ø¯Ù‡
      headerRow.innerHTML = '';
      fieldOrder.forEach(key => {
        const th = document.createElement('th');
        th.textContent = key;
        headerRow.appendChild(th);
      });

      // ðŸ” Ø³Ø§Ø®Øª Ø³Ø·Ø±Ù‡Ø§ Ø¨Ø§ ØªØ±ØªÛŒØ¨ Ù…Ø´Ø®Øµâ€ŒØ´Ø¯Ù‡
      tbody.innerHTML = '';
      entries.forEach(entry => {
        const tr = document.createElement('tr');
        fieldOrder.forEach(key => {
          const td = document.createElement('td');
          if (key === 'farmId') {
            const link = document.createElement('a');
            link.href = "#";
            link.textContent = entry[key];
            link.addEventListener('click', (e) => {
              e.preventDefault();
              showModal(entry);
            });
            td.appendChild(link);
          } else {
            td.textContent = entry[key] || "";
          }
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });

      function showModal(entry) {
        modalContentTable.innerHTML = '';
        fieldOrder.forEach(key => {
          const row = document.createElement('tr');
          const th = document.createElement('th');
          th.textContent = key;
          const td = document.createElement('td');
          td.textContent = entry[key] || "";
          row.appendChild(th);
          row.appendChild(td);
          modalContentTable.appendChild(row);
        });
        modal.style.display = 'block';
      }

      closeModal.onclick = function () {
        modal.style.display = 'none';
      };
      window.onclick = function (event) {
        if (event.target == modal) {
          modal.style.display = 'none';
        }
      };
    });
  };
</script>
