<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCmT1fhhlwlJ_EqqLdgNDNNEdb53MzCCR4",
    authDomain: "fesh-project.firebaseapp.com",
    databaseURL: "https://fesh-project-default-rtdb.firebaseio.com",
    projectId: "fesh-project",
    storageBucket: "fesh-project.firebasestorage.app",
    messagingSenderId: "775712995019",
    appId: "1:775712995019:web:d6658af65a13bbe737cd4e"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const dbRef = ref(db, "submissions");

  const headerRow = document.getElementById('tableHeader');
  const tbody = document.getElementById('tableBody');
  const modal = document.getElementById('modal');
  const modalContentTable = document.getElementById('detailsTable');
  const closeModal = document.getElementById('closeModal');

  onValue(dbRef, (snapshot) => {
    const data = snapshot.val();
    tbody.innerHTML = '';
    headerRow.innerHTML = '';

    if (!data) {
      tbody.innerHTML = '<tr><td colspan="4">No data available.</td></tr>';
      return;
    }

    const entries = Object.values(data);
    const keys = Object.keys(entries[0]);

    // Create table header
    keys.forEach(key => {
      const th = document.createElement('th');
      th.textContent = key;
      headerRow.appendChild(th);
    });

    // Create table rows
    entries.forEach(entry => {
      const tr = document.createElement('tr');
      keys.forEach(key => {
        const td = document.createElement('td');
        if (key === 'farmID') {
          const link = document.createElement('a');
          link.href = "#";
          link.textContent = entry[key];
          link.addEventListener('click', (e) => {
            e.preventDefault();
            showModal(entry);
          });
          td.appendChild(link);
        } else {
          td.textContent = entry[key];
        }
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    });
  });

  function showModal(entry) {
    modalContentTable.innerHTML = '';
    for (const key in entry) {
      const row = document.createElement('tr');
      const th = document.createElement('th');
      th.textContent = key;
      const td = document.createElement('td');
      td.textContent = entry[key];
      row.appendChild(th);
      row.appendChild(td);
      modalContentTable.appendChild(row);
    }
    modal.style.display = 'block';
  }

  closeModal.onclick = function () {
    modal.style.display = 'none';
  };

  window.onclick = function (event) {
    if (event.target == modal) {
      modal.style.display = 'none';
    }
  };
</script>
