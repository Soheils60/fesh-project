<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FESH - Full 7-Step Soil Health Form</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
      margin: 20px;
    }
    .step-header {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 20px;
    }
    .step-box {
      padding: 10px 15px;
      border-radius: 8px;
      margin: 5px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      background-color: crimson;
    }
    .step-box.completed {
      background-color: green;
    }
    .step {
      display: none;
      padding: 20px;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .step.active {
      display: block;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 10px;
    }
    input, select, textarea {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    .mic-button {
      margin-left: 10px;
      font-size: 18px;
      cursor: pointer;
      background: none;
      border: none;
    }
    button {
      margin-top: 15px;
      padding: 10px 20px;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    img {
      max-width: 100%;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<h2>FESH (Field Evaluation of Soil Health) - Full Form</h2>
<div class="step-header" id="stepHeader"></div>
<form id="feshForm" onsubmit="return false;">
  <div id="formSteps"></div>
</form>

<script>
const stepTitles = [
  "General Info", "Crop Info", "Topography", "Physical Soil",
  "Chemical Soil", "Biological Soil", "Crop Yield"
];

const soilColors = [
  "Very Dark Gray", "Dark Gray", "Gray", "Light Gray", "Very Pale Brown",
  "Pale Brown", "Brown", "Dark Brown", "Yellowish Brown", "Strong Brown",
  "Reddish Brown", "Dark Reddish Brown", "Light Yellowish Brown", "Dark Yellowish Brown",
  "Yellow", "Strong Yellow", "Grayish Yellow", "Light Olive", "Olive", "Dark Olive",
  "Greenish Brown", "Light Reddish Brown", "Orange Brown", "Dark Grayish Brown"
];

const cropOptions = [
  "Wheat", "Barley", "Corn", "Soybeans", "Oats", "Canola", "Potatoes", "Blueberries",
  "Carrots", "Cabbage", "Strawberries", "Turnip", "Apples", "Raspberries", "Pumpkins",
  "Maple (syrup trees)", "Green Beans", "Peas", "Beets", "Other"
];

function createStepHeader() {
  const header = document.getElementById("stepHeader");
  stepTitles.forEach((title, idx) => {
    const div = document.createElement("div");
    div.className = "step-box";
    div.textContent = `Step ${idx + 1}: ${title}`;
    div.id = `header-step${idx + 1}`;
    div.onclick = () => activateStep(idx + 1);
    header.appendChild(div);
  });
}

function createFormSteps() {
  const container = document.getElementById("formSteps");
  for (let i = 1; i <= 7; i++) {
    const stepDiv = document.createElement("div");
    stepDiv.className = `step${i === 1 ? ' active' : ''}`;
    stepDiv.id = `step${i}`;
    stepDiv.innerHTML = `<h3>Step ${i}: ${stepTitles[i-1]}</h3>` + getStepContent(i);
    container.appendChild(stepDiv);
  }
}

function getStepContent(step) {
  switch(step) {
    case 1:
      return `
        <label>Farmer Name <button class="mic-button" onclick="startDictation('farmerName')">üé§</button></label>
        <input type="text" id="farmerName" required>
        <label>Date</label>
        <input type="date" id="date" required>
        <label>Phone</label>
        <input type="tel" id="phone" required>
        <label>Latitude</label>
        <input type="text" id="latitude" readonly>
        <label>Longitude</label>
        <input type="text" id="longitude" readonly>
        <label>Elevation (m)</label>
        <input type="text" id="elevation" readonly>
        <button onclick="getLocation()">üìç Get GPS</button>
      `;
    case 2:
      return `
        <label>Crop Type</label>
        <select id="cropType" onchange="toggleOther('cropType','otherCrop')" required>
          ${cropOptions.map(c => `<option value="${c}">${c}</option>`).join('')}
        </select>
        <div id="otherCrop" style="display:none;">
          <label>Other:</label>
          <input type="text">
        </div>
        <label>Land Area (ha)</label>
        <input type="number" required>
      `;
    case 3:
      return `
        <label>Slope (deg or %)</label>
        <input type="number" id="slopeValue" required>
        <select id="slopeUnit"><option>deg</option><option>percent</option></select>
        <label>Converted:</label>
        <input type="text" id="slopeConverted" readonly>
        <label>Slope Direction</label>
        <select required><option>North</option><option>South</option><option>East</option><option>West</option></select>
        <label>Landscape Position</label>
        <select required><option>Hilltop</option><option>Valley</option><option>Flatland</option></select>
        <label>Surface Form</label>
        <select required><option>Flat</option><option>Concave</option><option>Convex</option></select>
      `;
    case 4:
      return `
        <label>Tillage Layer Depth (cm)</label><input type="number" required>
        <label>Soil Strength</label><input type="number" required>
        <label>VESS Score</label>
        <select required><option>Sq1</option><option>Sq2</option><option>Sq3</option><option>Sq4</option><option>Sq5</option></select>
        <label>Water Infiltration Time</label><input type="text" placeholder="min:sec" required>
        <img src="images/vess_guide.png" alt="VESS Guide">
      `;
    case 5:
      return `
        <label>Soil pH</label><input type="number" step="0.1" required>
        <label>Soil Color</label>
        <select required>
          ${soilColors.map(c => `<option>${c}</option>`).join('')}
        </select>
        <img src="images/color_soil.jpg" alt="Soil Color Guide">
      `;
    case 6:
      return `
        <label>Plant Emergence Rate</label><select required><option>Low</option><option>Medium</option><option>High</option></select>
        <label>Root Development</label><select required><option>Poor</option><option>Moderate</option><option>Good</option><option>Excellent</option></select>
        <label>Earthworm Count</label><input type="number" required>
        <label>Mycelium Development</label><select required><option>Low</option><option>Medium</option><option>High</option></select>
      `;
    case 7:
      return `
        <label>Crop Type</label>
        <select onchange="toggleOther('yieldCrop','otherYield')" required>
          ${cropOptions.map(c => `<option>${c}</option>`).join('')}
        </select>
        <div id="otherYield" style="display:none;">
          <label>Specify Other:</label><input type="text">
        </div>
        <label>Yield Value</label><input type="number" required>
        <label>Unit</label><select required><option>t/ha</option><option>kg/ha</option></select>
        <label>Note</label><textarea></textarea>
      `;
  }
}

function activateStep(step) {
  for (let i = 1; i <= 7; i++) {
    document.getElementById("step" + i).classList.remove("active");
  }
  document.getElementById("step" + step).classList.add("active");
}

function toggleOther(selectId, containerId) {
  const value = document.getElementById(selectId).value;
  document.getElementById(containerId).style.display = value === "Other" ? "block" : "none";
}

function getLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function (pos) {
      document.getElementById("latitude").value = pos.coords.latitude.toFixed(6);
      document.getElementById("longitude").value = pos.coords.longitude.toFixed(6);
      document.getElementById("elevation").value = (100 + Math.random() * 50).toFixed(2);
    });
  }
}

function startDictation(fieldId) {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!SpeechRecognition) {
    alert("Speech recognition not supported."); return;
  }
  const recognition = new SpeechRecognition();
  recognition.lang = "en-US";
  recognition.onresult = function (event) {
    document.getElementById(fieldId).value = event.results[0][0].transcript;
  };
  recognition.onerror = function () {
    alert("Microphone error");
  };
  recognition.start();
}

window.onload = function () {
  createStepHeader();
  createFormSteps();
};
</script>

</body>
</html>
